# API Gateway Configuration for Experience Lambda
# Portfolio Serverless System - Professional Experience Management Service

lambda_function:
  name: experience
  description: "Professional experience management Lambda function"
  handler: lambda_function.lambda_handler
  runtime: python3.12
  timeout: 30
  memory_size: 512

  # Environment variables for Lambda
  environment_variables:
    DATABASE_URL: "postgresql://postgres:portfolio_password@portfolio-db:5432/portfolio_local"
    NEON_DATABASE_URL: "postgresql://postgres:portfolio_password@neon-proxy:5433/portfolio_local"
    LOG_LEVEL: "info"
    ENVIRONMENT: "local"
    SERVICE_NAME: "experience"

  # Shared modules this lambda uses
  shared_modules:
    - database
    - models
    - repository
    - config
    - utils
    - exceptions

api_gateway:
  # API Gateway resource configuration
  resource:
    path: "experience"
    description: "Professional experience management endpoints"

  # HTTP methods and their configurations
  methods:
    - http_method: GET
      description: "Get professional experience timeline"
      authorization: NONE
      cors_enabled: true
      request_parameters:
        method.request.querystring.company: false
        method.request.querystring.current: false
        method.request.querystring.start_date: false
        method.request.querystring.end_date: false
      request_validator: none

    - http_method: POST
      description: "Add new experience entry"
      authorization: NONE
      cors_enabled: true
      request_parameters: {}
      request_validator: body

    - http_method: PUT
      description: "Update experience entry"
      authorization: NONE
      cors_enabled: true
      request_parameters: {}
      request_validator: body

    - http_method: DELETE
      description: "Delete experience entry"
      authorization: NONE
      cors_enabled: true
      request_parameters:
        method.request.querystring.experience_id: true
      request_validator: none

  # Additional endpoints for experience
  sub_resources:
    - path: "timeline"
      description: "Experience timeline view"
      methods:
        - http_method: GET
          description: "Get chronological experience timeline"
          authorization: NONE
          cors_enabled: true

    - path: "current"
      description: "Current employment endpoint"
      methods:
        - http_method: GET
          description: "Get current employment information"
          authorization: NONE
          cors_enabled: true

    - path: "technologies"
      description: "Technologies used across experience"
      methods:
        - http_method: GET
          description: "Get all technologies used in professional experience"
          authorization: NONE
          cors_enabled: true

  # CORS configuration
  cors:
    allow_origins:
      - "*"
    allow_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"
    allow_headers:
      - "Content-Type"
      - "X-Amz-Date"
      - "Authorization"
      - "X-Api-Key"
      - "X-Amz-Security-Token"
      - "X-Correlation-ID"
    max_age: 3600

  # Integration configuration
  integration:
    type: AWS_PROXY
    integration_method: POST
    passthrough_behavior: WHEN_NO_MATCH
    content_handling: CONVERT_TO_TEXT
    timeout: 29000

  # Response configuration
  responses:
    - status_code: 200
      description: "Successful response"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 201
      description: "Experience created successfully"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 400
      description: "Bad request"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 404
      description: "Experience not found"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 500
      description: "Internal server error"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

# Testing configuration
testing:
  # Sample requests for testing
  sample_requests:
    - method: GET
      path: "/experience"
      description: "Get all professional experience"
      expected_status: 200

    - method: GET
      path: "/experience/timeline"
      description: "Get experience timeline"
      expected_status: 200

    - method: GET
      path: "/experience/current"
      description: "Get current employment"
      expected_status: 200

    - method: GET
      path: "/experience/technologies"
      description: "Get technologies used in experience"
      expected_status: 200

    - method: POST
      path: "/experience"
      description: "Add new experience entry"
      body: |
        {
          "company": "TechCorp",
          "position": "Senior Python Developer",
          "location": "Santiago, Chile",
          "start_date": "2023-01-01",
          "end_date": null,
          "is_current": true,
          "description": "Leading server development",
          "technologies": ["Python", "FastAPI", "PostgreSQL", "AWS"]
        }
      expected_status: 201

# Monitoring configuration
monitoring:
  cloudwatch_logs: true
  x_ray_tracing: false
  custom_metrics:
    - name: "ExperienceRequests"
      unit: "Count"
      description: "Number of experience requests"
    - name: "ExperienceLatency"
      unit: "Milliseconds"
      description: "Experience response latency"