# API Gateway Configuration for Skills Lambda
# Portfolio Serverless System - Technical Skills Management Service

lambda_function:
  name: skills
  description: "Technical skills management Lambda function"
  handler: lambda_function.lambda_handler
  runtime: python3.12
  timeout: 30
  memory_size: 512

  # Environment variables for Lambda
  environment_variables:
    DATABASE_URL: "postgresql://postgres:portfolio_password@portfolio-db:5432/portfolio_local"
    NEON_DATABASE_URL: "postgresql://postgres:portfolio_password@neon-proxy:5433/portfolio_local"
    LOG_LEVEL: "info"
    ENVIRONMENT: "local"
    SERVICE_NAME: "skills"

  # Shared modules this lambda uses
  shared_modules:
    - database
    - models
    - repository
    - config
    - utils
    - exceptions

api_gateway:
  # API Gateway resource configuration
  resource:
    path: "skills"
    description: "Technical skills management endpoints"

  # HTTP methods and their configurations
  methods:
    - http_method: GET
      description: "Get all skills or filter by category"
      authorization: NONE
      cors_enabled: true
      request_parameters:
        method.request.querystring.category: false
        method.request.querystring.featured: false
        method.request.querystring.level: false
      request_validator: none

    - http_method: POST
      description: "Create new skill"
      authorization: NONE
      cors_enabled: true
      request_parameters: {}
      request_validator: body

    - http_method: PUT
      description: "Update skill"
      authorization: NONE
      cors_enabled: true
      request_parameters: {}
      request_validator: body

    - http_method: DELETE
      description: "Delete skill"
      authorization: NONE
      cors_enabled: true
      request_parameters:
        method.request.querystring.skill_id: true
      request_validator: none

  # Additional endpoints for skills
  sub_resources:
    - path: "categories"
      description: "Skill categories management"
      methods:
        - http_method: GET
          description: "Get all skill categories"
          authorization: NONE
          cors_enabled: true

    - path: "featured"
      description: "Featured skills endpoint"
      methods:
        - http_method: GET
          description: "Get featured skills"
          authorization: NONE
          cors_enabled: true

  # CORS configuration
  cors:
    allow_origins:
      - "*"
    allow_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"
    allow_headers:
      - "Content-Type"
      - "X-Amz-Date"
      - "Authorization"
      - "X-Api-Key"
      - "X-Amz-Security-Token"
      - "X-Correlation-ID"
    max_age: 3600

  # Integration configuration
  integration:
    type: AWS_PROXY
    integration_method: POST
    passthrough_behavior: WHEN_NO_MATCH
    content_handling: CONVERT_TO_TEXT
    timeout: 29000

  # Response configuration
  responses:
    - status_code: 200
      description: "Successful response"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 201
      description: "Created successfully"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 400
      description: "Bad request"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 404
      description: "Skill not found"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 500
      description: "Internal server error"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

# Testing configuration
testing:
  # Sample requests for testing
  sample_requests:
    - method: GET
      path: "/skills"
      description: "Get all skills"
      expected_status: 200

    - method: GET
      path: "/skills?category=frontend"
      description: "Get frontend skills"
      expected_status: 200

    - method: GET
      path: "/skills/featured"
      description: "Get featured skills"
      expected_status: 200

    - method: POST
      path: "/skills"
      description: "Create new skill"
      body: |
        {
          "name": "Python",
          "category": "server",
          "level": 5,
          "years_experience": 8,
          "description": "Advanced Python development"
        }
      expected_status: 201

# Monitoring configuration
monitoring:
  cloudwatch_logs: true
  x_ray_tracing: false
  custom_metrics:
    - name: "SkillsRequests"
      unit: "Count"
      description: "Number of skills requests"
    - name: "SkillsLatency"
      unit: "Milliseconds"
      description: "Skills response latency"