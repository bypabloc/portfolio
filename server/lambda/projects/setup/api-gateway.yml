# API Gateway Configuration for Projects Lambda
# Portfolio Serverless System - Project Portfolio Management Service

lambda_function:
  name: projects
  description: "Project portfolio management Lambda function"
  handler: lambda_function.lambda_handler
  runtime: python3.12
  timeout: 30
  memory_size: 512

  # Environment variables for Lambda
  environment_variables:
    DATABASE_URL: "postgresql://postgres:portfolio_password@portfolio-db:5432/portfolio_local"
    NEON_DATABASE_URL: "postgresql://postgres:portfolio_password@neon-proxy:5433/portfolio_local"
    LOG_LEVEL: "info"
    ENVIRONMENT: "local"
    SERVICE_NAME: "projects"

  # Shared modules this lambda uses
  shared_modules:
    - database
    - models
    - repository
    - config
    - utils
    - exceptions

api_gateway:
  # API Gateway resource configuration
  resource:
    path: "projects"
    description: "Project portfolio management endpoints"

  # HTTP methods and their configurations
  methods:
    - http_method: GET
      description: "Get project portfolio"
      authorization: NONE
      cors_enabled: true
      request_parameters:
        method.request.querystring.category: false
        method.request.querystring.status: false
        method.request.querystring.featured: false
        method.request.querystring.technology: false
      request_validator: none

    - http_method: POST
      description: "Add new project"
      authorization: NONE
      cors_enabled: true
      request_parameters: {}
      request_validator: body

    - http_method: PUT
      description: "Update project"
      authorization: NONE
      cors_enabled: true
      request_parameters: {}
      request_validator: body

    - http_method: DELETE
      description: "Delete project"
      authorization: NONE
      cors_enabled: true
      request_parameters:
        method.request.querystring.project_id: true
      request_validator: none

  # Additional endpoints for projects
  sub_resources:
    - path: "featured"
      description: "Featured projects endpoint"
      methods:
        - http_method: GET
          description: "Get featured projects"
          authorization: NONE
          cors_enabled: true

    - path: "categories"
      description: "Project categories"
      methods:
        - http_method: GET
          description: "Get all project categories"
          authorization: NONE
          cors_enabled: true

    - path: "technologies"
      description: "Technologies used in projects"
      methods:
        - http_method: GET
          description: "Get all technologies used across projects"
          authorization: NONE
          cors_enabled: true

    - path: "status"
      description: "Projects by status"
      methods:
        - http_method: GET
          description: "Get projects grouped by status"
          authorization: NONE
          cors_enabled: true

  # CORS configuration
  cors:
    allow_origins:
      - "*"
    allow_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"
    allow_headers:
      - "Content-Type"
      - "X-Amz-Date"
      - "Authorization"
      - "X-Api-Key"
      - "X-Amz-Security-Token"
      - "X-Correlation-ID"
    max_age: 3600

  # Integration configuration
  integration:
    type: AWS_PROXY
    integration_method: POST
    passthrough_behavior: WHEN_NO_MATCH
    content_handling: CONVERT_TO_TEXT
    timeout: 29000

  # Response configuration
  responses:
    - status_code: 200
      description: "Successful response"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 201
      description: "Project created successfully"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 400
      description: "Bad request"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 404
      description: "Project not found"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

    - status_code: 500
      description: "Internal server error"
      headers:
        Access-Control-Allow-Origin: "'*'"
        Content-Type: "'application/json'"

# Testing configuration
testing:
  # Sample requests for testing
  sample_requests:
    - method: GET
      path: "/projects"
      description: "Get all projects"
      expected_status: 200

    - method: GET
      path: "/projects/featured"
      description: "Get featured projects"
      expected_status: 200

    - method: GET
      path: "/projects?category=web"
      description: "Get web projects"
      expected_status: 200

    - method: GET
      path: "/projects?status=completed"
      description: "Get completed projects"
      expected_status: 200

    - method: GET
      path: "/projects/technologies"
      description: "Get project technologies"
      expected_status: 200

    - method: POST
      path: "/projects"
      description: "Add new project"
      body: |
        {
          "name": "portfolio-system",
          "title": "Portfolio Serverless System",
          "description": "Modern serverless portfolio with FastAPI and Astro",
          "status": "in_progress",
          "technologies": ["Python", "FastAPI", "Astro", "PostgreSQL", "Docker"],
          "github_url": "https://github.com/bypabloc/portfolio",
          "category": "web",
          "featured": true
        }
      expected_status: 201

# Monitoring configuration
monitoring:
  cloudwatch_logs: true
  x_ray_tracing: false
  custom_metrics:
    - name: "ProjectsRequests"
      unit: "Count"
      description: "Number of projects requests"
    - name: "ProjectsLatency"
      unit: "Milliseconds"
      description: "Projects response latency"